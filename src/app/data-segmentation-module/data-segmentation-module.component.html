<div class="container-fluid mt-3">
    <h2>Data Segmentation Modules</h2>
    <p class="text-muted">Manage data segmentation modules that define categories, purposes, and policies for consent management.</p>

    @if (loading()) {
        <div class="alert alert-info">
            <i class="bi-hourglass-split"></i> Loading modules...
        </div>
    }

    @if (isEmpty()) {
        <div class="alert alert-info">
            <i class="bi-info-circle"></i> No modules registered.
        </div>
    }

    @if (!loading() && hasModules()) {
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Version</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @for (module of modules(); track module.id) {
                        <tr>
                            <td>
                                <div><strong>{{ module.name }}</strong></div>
                                <div class="text-muted small">{{ module.id }}</div>
                            </td>
                            <td>{{ module.version || 'N/A' }}</td>
                            <td>{{ module.description || 'No description' }}</td>
                            <td>
                                <span class="badge" [class.bg-success]="module.enabled" [class.bg-secondary]="!module.enabled">
                                    {{ module.enabled ? 'Enabled' : 'Disabled' }}
                                </span>
                            </td>
                            <td>
                                <div class="btn-group" role="group">
                                    <a class="btn btn-sm btn-primary" [routerLink]="['/system/modules', module.id, 'edit']" id="edit-module-{{module.id}}">
                                        <i class="bi bi-pencil"></i> Edit
                                    </a>
                                    <button class="btn btn-sm" 
                                            [class.btn-success]="!module.enabled" 
                                            [class.btn-warning]="module.enabled"
                                            [disabled]="isToggling(module.id)"
                                            (click)="toggleModule(module)">
                                        @if (isToggling(module.id)) {
                                            <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
                                        }
                                        @if (!isToggling(module.id)) {
                                            <i class="bi" [class.bi-toggle-on]="module.enabled" [class.bi-toggle-off]="!module.enabled"></i>
                                        }
                                        {{ module.enabled ? 'Disable' : 'Enable' }}
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

